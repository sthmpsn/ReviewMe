<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">
    <link rel="stylesheet" href="assets/styles/styles.css">
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.0/firebase.js"></script>
    <title>MyReviews</title>
</head>

<body class="bg-light">
    <div class="container container-fluid border">
        <div id="row-header" class="row pl-3 bg-white border border-muted align-items-center">
            <div id="header-logo" class="col-2 col-md-2 text-center">
                <img id="imgLogo" class="header-imgs" src="assets/images/logo.png" alt="logo MyReviews">
            </div>
            <div id="header-brand" class="col-4 col-md-3 pl-0">
                MyReviews
            </div>
            <div id="header-userInfo" class="col-4 col-md-7 pr-md-5">
                <div id="row-avatar" class="row">
                    <div id="avatar" class="col text-right pr-md-4 ">
                        <img id="imgAvatar" class="header-imgs" src="assets/images/avatars/avatar-placeholder.png" alt="Avatar">
                    </div>
                </div>
                <div id="row-username" class="row">
                    <div id="username" class="col text-right pr-md-1">
                        <a href="index.html">not &lt;username&gt;?</a>
                    </div>
                </div>
            </div>
        </div>
        <div id="row-content" class="row">
            <div id="review-categories" class="col col-12 col-md-3 px-0">
                <button id="bttn-createReview" class="w-100 py-3 m-0 h3">Create Review</button>
                <button id="beer" class="category-items w-100 h3 text-white">
                    Beer
                </button>
                <button id="restaurants" class="category-items w-100 h3 text-white">
                    Restaurants
                </button>
            </div>
            <div id="review-content" class="col col-12 col-md-9">

            </div>
        </div>
        <div id="row-footer" class="row">
            <div id="footer-left" class="col-3 footer text-center text-white">
                <img id="imgSkull" class="footer-imgs" src="assets/images/skull.png" alt="Skull">
            </div>
            <div id="footer-center" class="col footer text-center text-white align-self-end">
                Copyright Â© 2019 Exceptional Pirates Inc
            </div>
            <div id="footer-right" class="col-3 footer text-center text-white">
                <img id="imgShip" class="footer-imgs" src="assets/images/flag.gif" alt="flag">
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="assets/javascript/javascript.js"></script>
</body>
<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase.js"></script>
<script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyCYMFkr7RuA6LabcsxJulA93r57UpIHFMw",
        authDomain: "exceptional-pirates.firebaseapp.com",
        databaseURL: "https://exceptional-pirates.firebaseio.com",
        projectId: "exceptional-pirates",
        storageBucket: "exceptional-pirates.appspot.com",
        messagingSenderId: "756087661991"
    };
    firebase.initializeApp(config);
    var database = firebase.database();
    var username;
    var review_rating;
    var avatar;
    var review;
    var myPreferences = "";
    var place;

    var users = {
        person1: {
            name: "Jim",
            reviews: {
                review1: {
                    name: "Bush Lght",
                    class: "beer",
                    rating: "4.0"
                }
            }
        },
        person2: {
            name: "Joe",
            reviews: {
                review1: {
                    name: "Bud Light",
                    class: "beer",
                    rating: "4.0"
                },
                review2: {
                    name: "Arby's",
                    class: "restaurants",
                    rating: "5.0"
                },
                review3: {
                    name: "Wendy's",
                    class: "restaurants",
                    rating: "3.0"
                }
            }
        }
    }


    // $(".category-items").on("click", function () {
    //     $("#review-content").empty();
    //     var myPrefrences = users.person2.reviews;
    //     console.log($(this).attr("id"));
    //     for (key in myPrefrences) {
    //         if (myPrefrences[key].class == $(this).attr("id")) {
    //             console.log(myPrefrences[key].name);
    //             console.log(myPrefrences[key].rating);
    //             $("#review-content").append(`
    //             <div id="review-id" class="review-summaries mx-md-3 my-md-3">
    //                     <!-- review.name -->
    //                     <h5>${myPrefrences[key].name}</h5>
    //                     <!-- review.rating -->
    //                     ${myPrefrences[key].rating}
    //                     <div class="form-group static-rating m-0">
    //                         <div class="col-auto col star-ratings-static">
    //                             <span id="rating1" class="fa fa-star" rating="1"></span>
    //                             <span id="rating2" class="fa fa-star" rating="2"></span>
    //                             <span id="rating3" class="fa fa-star" rating="3"></span>
    //                             <span id="rating4" class="fa fa-star" rating="4"></span>
    //                             <span id="rating5" class="fa fa-star" rating="5"></span>
    //                         </div>
    //                     </div>
    //                 </div>

    $("#restaurants").on("click", function () {
        $("#review-content").empty();
        database.ref().on("child_added", function (childSnapshot) {
            myPreferences = childSnapshot.val().Jim.reviews;
            for (key in myPreferences) {
                //console.log(myPreferences[key].class)
                if (myPreferences[key].class == "restaurants") {
                    $("#review-content").append(`
                <div id="${myPreferences[key].name}" class="review-summaries mx-md-3 my-md-3">
                        
                        <h5>${myPreferences[key].name}</h5>
                        
                        <h5>${myPreferences[key].rating}</h5>
                    </div>
                    `);

                }
            }
        });
    });

    $("#beer").on("click", function () {
        $("#review-content").empty();
        database.ref().on("child_added", function (childSnapshot) {
            myPreferences = childSnapshot.val().Jim.reviews;
            for (key in myPreferences) {
                if (myPreferences[key].class == "beer") {
                    //console.log(myPreferences[key].name);
                    //console.log(myPreferences[key].rating);
                    $("#review-content").append(`
                <div id="${myPreferences[key].name}" class="review-summaries mx-md-3 my-md-3">
                        <h5>${myPreferences[key].name}</h5>
                        <h5>${myPreferences[key].rating}</h5>
                    </div>
                    `);

                }
            }
        });
    });

    function changeTargetSrc(searchKey,type) {
        var queryUrl =
            `https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=1c7f330fcebe7bd701c8c8fe9de59c12&text=${searchKey}+${type}&sort=relevance&format=json&nojsoncallback=1`
        $.ajax({
            url: queryUrl,
            method: "GET"
        }).then(function (response) {
            console.log(response.photos.photo[0]);
            var photoId = response.photos.photo[0].id;
            var photoSecret = response.photos.photo[0].secret;
            var photoServer = response.photos.photo[0].server;
            var photoFarm = response.photos.photo[0].farm;
            var myImageUrl = `https://farm${photoFarm}.staticflickr.com/${photoServer}/${photoId}_${photoSecret}.jpg`
            $(`#review-img`).attr("src", myImageUrl);
        });
    }
    $(document).on("click", ".review-summaries", function () {
        //console.log(myPreferences[key]);
        var myId = $(this).attr("id");
        for (key in myPreferences) {
            //console.log(myPreferences[key].class)
            if (myPreferences[key].name == myId) {
                $("#first").on("click", function () {
                    $("iframe").attr("src", "https://www.google.com/maps/embed/v1/search?q=mcdonalds&key=AIzaSyDz_LZnOTM0GcmyL6VQ7DsDfZmZ-Pi3LcA")
                });
                $("#review-content").empty();
                $("#review-content").append(`<div id="row-form" class="row">
    <div id="col-form" class="col p-0 px-md-5 py-md-5">
        <div class="card">
            <div class="card-header text-white h5">
                Review Details
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-5 col-form-left p-0">
                        <div class="form-group m-0">
                            <img id="review-img" alt="Review Item Name">
                        </div>
                        <div class="form-group m-0">
                            <div>${myPreferences[key].name}</div>
                        </div>

                    </div>
                    <div class="col-7 p-0 pr-3">
                        <div class="form-group">
                            <div id="review-Category">
                                <label for="reviewCategory" class="font-weight-bold mr-3">Category</label>
                                <div>${myPreferences[key].class}</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div id="review-comments">
                                <label for="reviewComments" class="font-weight-bold">Comments</label>
                                <textarea class="form-control" id="reviewComments" rows="5"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group mt-3">
                    <div id="review-map" class="col-12 col p-0 border">
                        <iframe width="100%" height="100%" frameborder="0" style="border:0" src='https://www.google.com/maps/embed/v1/search?q=${myPreferences[key].name}&key=AIzaSyDz_LZnOTM0GcmyL6VQ7DsDfZmZ-Pi3LcA' allowfullscreen></iframe>
                    </div>
                </div>
                <button id="review-bttnSave" class="btn mt-3 px-3 float-right text-white"><span class="h6">Close</span></button>
            </div>
        </div>
    </div>
</div>`);
changeTargetSrc(myPreferences[key].name,myPreferences[key].class);
            }
        }




    });












</script>

</html>